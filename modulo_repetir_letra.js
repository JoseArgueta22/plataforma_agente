let palabrasPorLetra = {
    A: ["Amor", "Amigo", "Árbol", "Avión", "Abrigo", "Arco", "Arena", "Aire", "Anillo", "Ave", 
        "Aventura", "Aceite", "Alfombra", "Antorcha", "Aliento", "Atracción", "Alimento", "Azúcar", 
        "Acero", "Acuario", "Ajuste", "Amistad", "Antena", "Arte", "Atención", "Acierto", 
        "Amuleto", "Aroma", "Actividad", "Aplauso", "Adivinanza", "Animal", "Aguacate", "Amarillo", 
        "Aguja", "Abuelo", "Abeja", "Alas", "Avance", "Adorno", "Animación", "Amanecer", "Atrio", 
        "Apoyo", "Almohada", "Almuerzo", "Águila"],

    B: ["Barco", "Beso", "Bailar", "Bola", "Bebé", "Bicicleta", "Boca", "Buzo", "Bandera", "Burro", 
       "Banco", "Barba", "Brisa", "Broma", "Barro", "Botella", "Botón", "Bolsa", "Búho", "Burbuja", 
       "Bote", "Bailarina", "Bocina", "Barril", "Búfalo", "Bate", "Banda", "Boda", "Broche", 
        "Bufanda", "Bombilla", "Balcón", "Bisabuela", "Bolsillo", "Bocadillo", "Ballena", 
        "Barriga", "Bici", "Brillo", "Baile", "Besar", "Bañera", "Brócoli", "Bastón", "Balón", 
       "Bingo", "Barquito"
        ],   

    C: ["Casa", "Cielo", "Correr", "Coche", "Camino", "Cebra", "Cuchara", "Café", "Camisa", "Carro", 
       "Cama", "Cometa", "Copa", "Cereza", "Cinturón", "Cangrejo", "Colina", "Cubo", "Calle", 
        "Cepillo", "Callejón", "Cosecha", "Cima", "Cisne", "Catedral", "Cabo", "Cuadro", "Columpio", 
        "Colcha", "Concierto", "Concha", "Cobre", "Costura", "Cuerda", "Cómic", "Ciclo", "Cinta", 
        "Ceniza", "Calor", "Cálido"
        ],
        
    D: ["Dado", "Danza", "Diamante", "Delfín", "Dedo", "Diente", "Dulce", "Desierto", 
        "Desayuno", "Dibujo", "Dragón", "Don", "Durazno", "Debate", "Desafío", "Destino", 
        "Disciplina", "Documento", "Doble", "Derecho", "Dama", "Diseño", "Discoteca", 
        "Drama", "Diario", "Desvío", "Duda", "Dominio", "Donde", "Descanso", "Derrumbe", 
        "Distancia", "Despeje", "Deporte", "Dureza", "Dólar", "Dinámica",
        ],
        
    E: ["Elefante", "Espejo", "Escuela", "Estrella", "Espada", "Escritorio", "Estación", 
        "Escalera", "Espacio", "Ensalada", "Equipo", "Esfuerzo", "Energía", "Esponja", 
        "Edificio", "Experimento", "Escudo", "Éxito", "Examen", "Espectáculo", "Ejemplo", 
        "Estilo", "Ejército", "Esquina", "Estante", "Entrada", "Enciclopedia", "Emoción", 
        "Erupción", "Estadio", "Esencia", "Encanto", "Ecosistema", "Eclipse", "Escultura", 
        "Esquí", "Época", "Esqueleto", "Equilibrio", "Espina", "Escarabajo", "Empleo", 
        "Escritor", "Eslogan", "Evolución", "Enigma", "Escarcha", "Embajada", "Estructura", "Estatua"
        ],
        
      F: ["Flor", "Fruta", "Fuego", "Falda", "Frío", "Fuente", "Foca", "Flecha", "Fantasma", 
         "Faro", "Fuerza", "Frase", "Fútbol", "Fresa", "Familia", "Fiesta", "Fleco", 
        "Figura", "Fragancia", "Franja", "Fábrica", "Freno", "Flauta", "Fondo", "Favor", 
        "Fuga", "Folclore", "Fiebre", "Fiel", "Fortaleza", "Foso", "Filo", "Felino", 
        "Función", "Fantasía", "Fórmula", "Filamento", "Fotografía", "Frontera", 
        "Firma", "Funda", "Fortuna", "Furgoneta"
        ],
        
    G: ["Gato", "Globo", "Guitarra", "Gorra", "Guante", "Ganso", "Gol", "Galleta", "Goma", 
        "Grillo", "Guía", "Grúa", "Granada", "Grifo", "Gigante", "Gimnasio", "Garaje", 
        "Gloria", "Gel", "Generación", "Gemelo", "Gestión", "Guardia", "Género", "Garganta", 
        "Granizo", "Garra", "Gesto", "Galería", "Galaxia", "Gafas", "Gasa", "Gobernador", 
        "Gladiador", "Golondrina", "Gasolina", "Grano", "Gravedad", "Galletita", "Gráfico", 
        "Guacamayo", "Gélido", "Ganador", "Gema", "Golpe"
        ],
        
    H: ["Huevo", "Helado", "Hilo", "Hoja", "Hermano", "Hormiga", "Hacha", "Héroe", 
        "Helicóptero", "Hotel", "Historia", "Huella", "Hoguera", "Huracán", "Herradura", 
        "Hielo", "Hombre", "Humedad", "Horno", "Huerto", "Herramienta", "Habilidad", 
        "Honor", "Horario", "Horror", "Habla", "Hospital", "Humo", "Hueso", "Hiedra", 
        "Habitación", "Hierro", "Halcón", "Herencia", "Hospitalidad", "Himno", 
        "Hongo", "Hipopótamo", "Herida", "Honestidad", "Hortensia", "Horizonte", 
        "Hinchazón", "Hiena", "Habitante", "Hojalata"
        ],
        
    I: ["Isla", "Iglesia", "Imán", "Ídolo", "Invierno", "Insecto", "Iris", "Idea", 
        "Inteligente", "Instituto", "Independencia", "Inyección", "Instante", 
        "Interés", "Información", "Intención", "Iguana", "Ilusión", "Invento", 
        "Instrumento", "Inmenso", "Infinito", "Identidad", "Inequidad", 
        "Influencia", "Impresora", "Inclinación", "Invasión", "Incendio", 
        "Índice", "Interacción", "Inversión", "Infusión", "Inmortal", 
        "Instinto", "Integridad", "Iluminación", "Impulso", "Inglés", 
        "Intermedio", "Inteligencia", "Irrigación", "Instrucción", 
        "Ideal", "Intervención", "Ímpetu", "Imaginación"
        ],
        
    J: ["Jardín", "Jirafa", "Juguete", "Jugo", "Juego", "Joya", "Juez", "Jabón", 
        "Jirón", "Jengibre", "Jaula", "Jilguero", "Jarabe", "Jarra", "Jubileo", 
        "Juguetería", "Jornada", "Jardinería", "Jamonero", "Jinete", "Jardinero", 
        "Joyero", "Juguetón", "Jamón", "Jubilarse", "Jamás", 
        "Jarrón", "Justicia", "Juventud", "Jubilación", "Juicio", "Jaleo", 
        "José", "Jamaica", "Jazmín", "Jalapeño", "Jimenéz"
        ],
        
     K: ["Koala", "Kiwi", "Karate", "Karaoke", "Ken", 
        "Kiosco", "Kermés", "Kenia", "Kiko", "Kebab", 
        "Katherin", "Kilón", "Karla", "Kapsula", "Kasa", "Kitty", 
        "Kit", "Kito", "Kilo", "Kilómetro", "KoKayak", "Kevin", "Kiosco"
        ],

    L: ["Luna", "Lápiz", "Libro", "Luz", "León", "Lago", "Lobo", "Llorar", "Lluvia", "Lentejas",
        "Lámpara", "Laberinto", "Limonada", "Lucha", "Lengua", "Lazo", "Largo", "Lavadora", 
        "Lentitud", "Leche", "Lava", "Luzco", "Letrero", "Leyenda", "Lima", "Legumbre", 
        "Lagarto", "Lógica", "Libertad", "Ladrona", "Localidad", "Limpieza", "Llavero", 
        "Liana", "Líquido", "Laboratorio", "Lucha", "Lápices", "Limonero", "Llama", 
        "Luis", "Luzcita", "Libélula", "Lalo", "Lombriz", "Lucero", "Lucas", "Leñador", 
        "Luzca", "Librero", "Lámina", "Limón", "Lopéz", "Locomotora"
        ],
        
    M: ["Manzana", "Mesa", "Montaña", "Mar", "Martillo", "Mosca", "Mango", "Moto", "Miel", "Médico",
        "Murciélago", "Mujer", "Misterio", "Móvil", "Maleta", "Maestro", "Música", "Moneda", "Mineral", "Mochila",
        "Mariposa", "Mapa", "Movimiento", "Madera", "Maíz", "Memoria", "Montón", "Masa", "Manto", "Mundo",
        "Mermelada", "Morsa", "Mueble", "Motocicleta", "Motivo", "Magnífico", "Manos", "Matriz",
        "Modelo", "Maldición", "Montura", "Mente", "Meta", "Maquinaria", "Menú", "Mascota", "Misión", "Marcos",
        "Martes", "Murmullo", "Monstruo", "Mascarilla", "Maravilla","Mamá","Mochilita"
        ],
        
    N: ["Nube", "Nido", "Naranja", "Nieve", "Nariz", "Nota", "Niña", "Noche", "Nave", "Nuez",
        "Número", "Nervio", "Noria", "Neón", "Noble", "Nutria", "Naturaleza", "Nobleza", "Náutica", "Nacido",
        "Norte", "Navegar", "Novela", "Navegación", "Nariz",  "Nieve", "Nombre", "Náufrago", "Nene",
        "Nativo", "Nostalgia", "Náufrago", "Nebulosa", "Naciente", "Nutricción", "Nubarrón", "Nacer", "Nena", 
        "Nacional", "Neumático", "Navidad", "Nico", "Nitro", "Nudo", "Nómada", "Nácar", "Niveles", "Nochebuena"
        ],
        
    O: ["Oso", "Ola", "Oreja", "Olivo", "Ojo", "Oro", "Obra", "Olla", "Oscuro", "Oruga",
        "Ostras", "Ofrenda", "Olé", "Oficina", "Orgullo", "Océano", "Operación", "Ópera", "Oponente", 
        "Ocultar", "Ocaso", "Observador", "Órden", "Olimpíadas", "Óptica", "Oposición", "Óxido", 
        "Origen", "Orquesta", "Operador", "Ornamento", "Oportunidad", "Orbe", "Orquídea", "Octavo", 
        "Orejel", "Obeso", "Octubre", "Óptimo", "Oportuno", "Oído", "Oxígeno", "Oscilación", 
        "Ovolacto", "Ofrendar", "Oblea", "Obelisco", "Olor", "Osorio", "Oliva"
        ],
        
    P:["Perro", "Pelota", "Pato", "Piedra", "Paloma", "Plato", "Parque", "Puerta", "Playa", "Pez", 
        "Pluma", "Pasta", "Papel", "Pintura", "Piano", "Planta", "Pueblo", "Público", "Palabra", 
        "Poder", "Pasión", "Piloto", "Príncipe", "Pancarta", "Paquete", "Propósito", "Película", 
        "Plenitud", "Poderoso", "Pincel", "Pequeño", "Planeta", "Pollo", "Papelera", "Portafolio", 
        "Pista", "Pintor", "Paracaídas", "Preparación", "Perspectiva", "Protagonista", "Producción", 
        "Perdón", "Postre", "Pulsera", "Porción", "Paleta", "Pesca", "Picnic", "Pablo"
        ],
        
    Q: ["Queso", "Quinto", "Quimera", "Quijote", "Querido","Quimono", "Quiste", "Química", 
        "Quiniela", "Quijada", "Quetzal", "Quehacer", "Quinientos", 
        "Quebrada", "Qué", "Quilombo", "Quinque", "Quisiera", "Quiebre", "Quito", "Quitar", 
        "Quilograma", "Quinta", "Quinteto", "Querernos", "Quincena", "Quesadilla", "Quince", 
        "Quilón","Quijotada", "Quincuagésimo", "Quirófano",
        "Quiché", "Querida", "Quimioterapia", "Querer"
        ],
        
    R: ["Ratón", "Río", "Rosa", "Roca", "Rey", "Rueda", "Risa", "Rana", "Robot", "Rayo", 
        "Rápido", "Reloj", "Ropa", "Remedio", "Reina", "Rugido", "Rincón", "Ritmo", "Reptil", "Raíz", 
        "Resto", "Revista", "Rastro", "Rama", "Ritual", "Resorte", "Recurso", "Rugir", "Relojería", 
        "Rapunzel", "Remolino", "Recrear", "Rumbo", "Resistencia", "Rabo", "Rizo", "Relojito", "Rana", 
        "Rey", "Recreo", "Racimo", "Rábano", "Rato", "Regañón", "Regalo", "Rodillo", "Rojo", "Remolacha"
        ],
        
    S: ["Sol", "Silla", "Sapo", "Sombrero", "Sopa", "Sombra", "Sierra", "Sirena", "Serpiente", "Sueño", 
        "Sal", "Sangre", "Sándwich", "Sabiduría", "Suerte", "Semilla", "Sensible", "Susurro", "Sábado", 
        "Sustancia", "Salón", "Senda", "Salto", "Sonrisa", "Sendero", "Sociedad", "Salud", "Simpatía", 
        "Sentido", "Sustituto", "Sensación", "Suceso", "Simulación", "Sustento", "Sistema", "Sabio", 
        "Seguridad", "Secreto", "Silencio", "Sonido", "Sencillo", "Sutil", "Socorro", "Sentencia", 
        "Salvaje", "Sofá", "Serio", "Surtidor", "Segunda", "Submarino", "Sincero"
        ],
        
    T: ["Tigre", "Taza", "Tierra", "Techo", "Tenedor", "Teléfono", "Tortuga", "Trompeta", "Tren", "Tomate",
        "Tornado", "Túnel", "Técnico", "Tinta", "Tiro", "Tamarindo", "Ternura", "Tiburón", "Talla", "Torre",
        "Tropical", "Tristeza", "Taco", "Tarjeta", "Teatro", "Técnica", "Tercer", "Transporte", "Tropa",
        "Tradición", "Trampa", "Temor", "Tirador", "Teoría", "Tono", "Transformación", "Talento", "Tenis",
        "Toalla", "Truco", "Trébol", "Tratamiento", "Turismo", "Tejido", "Toma", "Travesura", "Término",
        "Tablero", "Táctica", "Trampolín", "Tatuaje", "Temática"
        ],
        
    U: ["Uva", "Universo", "Unicornio", "Uña", "Ukelele", "Urraca", "Uniforme", "Ulises", "Urbano", "Utopía",
        "Utilidad", "Universidad", "Urgente", "Unión", "Usual", "Urgencia", "Usanza",
        "Ultraje", "Ultimátum", "Universitaria", "Ultrasonido", "Ursino", "Ucrania", "Unidad", "Universitario",
        "Urna", "Unifamiliar", "Uranio", "Ube", "Ubaldo", "Ubedo", "Usar", "Ubiquo", "Uve",
        "Urgentología", "Unilateral","Usufructo", "Ubicación",
        "Ultimo", "Utensilio"
        ],
        
    V: ["Vaca", "Viento", "Vela", "Valle", "Vampiro", "Ventana", "Violeta", "Verano", "Vino", "Volar",
        "Verdura", "Voto", "Vigilia", "Volcán", "Vuelta", "Visión", "Vibración", "Veloz", "Vínculo", "Vigilante",
        "Verde", "Válvula", "Vendedor", "Velo", "Veneración", "Ventilador", "Vibrante", "Vivir", "Vacaciones",
        "Voluntad", "Vesícula", "Vaso", "Valor", "Vaguada", "Vocal", "Voluntario", "Victoria", "Vestido",
        "Vivienda", "Verso", "Vitamina", "Vocación", "Vértice", "Visita", "Visera", "Vigilancia", "Vespa", 
        "Venezolano"
        ],
        
    W: ["Wafle", "Web", "Wifi", "Wally", "Wombat", "Walter", "Wilfredo", "Waldo", "Webcam",
        "Wenceslao", "Wilmer", "Waflera", "Wellintong", "Wilma", "Waleska", "Wander", "Wanda",
        "Willy", "Wakanda","Werner", "Winifred", "Wesley","Wata", "Wendy", "Walt Disney", "Wipe", "Warley", 
        "Wario", "Wila", "Wade", "Watt", "Waldemar","Waterpolo", "Wallabí","Wendell"
        ],
        
    X: ["Xilófono","Ximenéz", "Xochitl", "Xander", "Xime",
        "Ximena", "Xilema", "Ximona", "Xomara", "Xiamara", "Xilberto", "Xavi",
        "Xavier", "Xian", "Xiselle", "Xiomara", "Xoelito", "Xilena", "Xelvin",
        "Xabriel", "Xadira", "Xaviera", "Xanti", "Xoloitzcuintli", "Xolo", "Xena",
        "Ximara", "Xenia", "Ximon", "Xany", "Xelena", "Ximene", "Xuliana"
        ],
        
    Y: ["Yate", "Yeso", "Yodo", "Yunque", "Yegua", "Yema", "Yelmo", "Yeti", 
        "Yasmín", "Yoyó", "Yugo", "Yamileht", "Yacente", "Yanet", 
        "Yvonne", "Yoshi", "Yogui", "Yesenia", "Youtuber", "Yonathan", "Yohan", 
        "Yessica", "Yuliana", "Yugular", "Yaneli", "Yanira", "Yoli", "Yadira", 
        "Yamal", "Yuca", "Yogurt", "Yeyé"
        ],
        
    Z: ["Zapato", "Zorro", "Zanahoria", "Zebra", "Zueco", "Zafiro", "Zanja", 
        "Zumo", "Zoológico", "Zumbido", "Zócalo", "Zapatilla", "Zorrillo", 
        "Zepelín", "Zarpar", "Zapatista", "Zacarías", "Zambullida", "Zeus", 
        "Zarigüeya", "Zoraya", "Zaira", "Zodiaco", "Zenia", "Zulma", 
        "Zigzaguear", "Zayra", "Zelene", "Zacate", "Zigzagueo", 
        "Zulema", "Zeyda", "Zacatecano"
        ],
};

let palabrasSeleccionadas = [];
let indicePalabraActual = 0;
let letraSeleccionada = null;
let moduloFinalizado = false;

function seleccionarPalabrasAleatorias(palabras) {
    let seleccionadas = [];
    let indicesUsados = new Set();
    
    while (seleccionadas.length < 20) {
        let indiceAleatorio = Math.floor(Math.random() * palabras.length);
        if (!indicesUsados.has(indiceAleatorio)) {
            seleccionadas.push(palabras[indiceAleatorio]);
            indicesUsados.add(indiceAleatorio);
        }
    }
    
    return seleccionadas;
}

function mostrarSiguientePalabra() {
    if (indicePalabraActual < palabrasSeleccionadas.length) {
        document.getElementById("palabra").textContent = palabrasSeleccionadas[indicePalabraActual];
        indicePalabraActual++;
        actualizarProgreso();

        if (indicePalabraActual === palabrasSeleccionadas.length) {
            moduloFinalizado = true;
            document.getElementById("seguir-button").textContent = "Finalizar";
        }
    } else if (moduloFinalizado) {
        mostrarModalFinal();
    }
}

function reproducirAudio() {
    let palabraActual = document.getElementById("palabra").textContent;
    let utterance = new SpeechSynthesisUtterance(palabraActual);
    speechSynthesis.speak(utterance);
}

function reiniciarModulo() {
    indicePalabraActual = 0;
    letraSeleccionada = null;
    palabrasSeleccionadas = [];
    moduloFinalizado = false;
    document.getElementById("resultados").style.display = "none";
    document.getElementById("seguir-button").style.display = "inline-block";
    document.getElementById("escuchar-button").style.display = "inline-block";
    document.getElementById("palabra").style.display = "block"; 
    document.getElementById("seguir-button").textContent = "Seguir"; 
    abrirModal('modal-letras');
    actualizarProgreso();
}

function regresar() {
    window.location.href = 'index.php'; 
}

function actualizarProgreso() {
    document.getElementById("progreso").value = indicePalabraActual;
    document.getElementById("progreso").max = palabrasSeleccionadas.length;
}

function cerrarModal(modalId) {
    document.getElementById(modalId).style.display = "none";
}

function abrirModal(modalId) {
    document.getElementById(modalId).style.display = "block";
}

function seleccionarLetra(letra) {
    letraSeleccionada = letra;
    palabrasSeleccionadas = seleccionarPalabrasAleatorias(palabrasPorLetra[letra]);  
    indicePalabraActual = 0;
    actualizarProgreso();
    cerrarModal('modal-letras');
    mostrarSiguientePalabra();
}

function mostrarModalFinal() {
    document.getElementById("seguir-button").style.display = "none";
    document.getElementById("escuchar-button").style.display = "none";
    document.getElementById("palabra").style.display = "none";  // Ocultar la palabra actual

    reproducirSonidoFinal(); // Reproducir el sonido

    // Mostrar el modal final con las palabras seleccionadas
    const resultadosDiv = document.getElementById("palabras-mostradas");
    resultadosDiv.innerHTML = "";  // Limpiar contenido previo
    palabrasSeleccionadas.forEach(palabra => {
        const palabraElement = document.createElement("p");
        palabraElement.textContent = palabra;
        resultadosDiv.appendChild(palabraElement);
    });

    // Mostrar los puntos obtenidos
    let puntosObtenidos = document.getElementById("puntos-obtenidos");
    if (puntosObtenidos) {
        puntosObtenidos.textContent = "¡Has ganado 100 puntos!";
    } else {
        console.error('El elemento #puntos-obtenidos no se encontró en el DOM.');
    }

    // Mostrar los botones para volver a jugar o regresar
    document.getElementById("volver-jugar-btn").style.display = "inline-block";
    document.getElementById("regresar-btn").style.display = "inline-block";

    // Mostrar la sección de resultados
    document.getElementById("resultados").style.display = "block";

    // Abrir el modal final
    abrirModal('modal-final');

    // Enviar puntos al servidor
    enviarPuntos(100);
}

function enviarPuntos(puntos) {
    fetch('guardar_puntos.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            puntos: puntos,
            modulo: 4 // numero de modulo
        }),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Respuesta del servidor:', data);
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

// Evento de clic para el botón "Seguir"
document.getElementById("seguir-button").onclick = function() {
    if (moduloFinalizado) {
        mostrarModalFinal(); // mostrar el modal cuando finalice
    } else {
        mostrarSiguientePalabra();
    }
};

document.getElementById("escuchar-button").onclick = function() {
    reproducirAudio();
};

// Cerrar el modal final cuando se hace clic fuera de él o en el botón "Listo"
document.getElementById("listo-btn").onclick = function() {
    cerrarModal('modal-final');
};

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        cerrarModal('modal-final');
    }
};

document.getElementById("volver-jugar-btn").onclick = function() {
    reiniciarModulo(); // Volver a jugar reiniciando el módulo
};

document.getElementById("regresar-btn").onclick = function() {
    regresar(); // Regresar a la pantalla principal
};

function generarLetras() {
    const letrasContainer = document.getElementById("letras-container");
    Object.keys(palabrasPorLetra).forEach(letra => {
        const btn = document.createElement("button");
        btn.textContent = letra;
        btn.onclick = () => seleccionarLetra(letra);
        letrasContainer.appendChild(btn);
    });
}

// Función para reproducir el sonido al mostrar el modal final
function reproducirSonidoFinal() {
    const audio = new Audio('sounds/grito.wav');
    audio.play().catch(error => {
        console.error('Error al reproducir el sonido:', error);
    });
}

// Inicialización
window.onload = function() {
    generarLetras();
    abrirModal('modal-letras');
};
